<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>
      <ion-icon name="person-outline"></ion-icon>
      ข้อมูลสินเชื่อ ปี {{ yearDesc }}
    </ion-title>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- ข้อมูลด้านสินเชื่อ -->
  <ion-card class="boxGreenPowerpointR w3-light-blue divPadding-10" style="margin-bottom: 25px;">
    <ion-card-content>
      <div style="margin-top: 3%;">
        <ion-card-title style="margin-bottom: 3%;" color="dark">ข้อมูลด้านสินเชื่อ</ion-card-title>
        <ion-list>
          <ion-item [button]="true" lines="full">
            <ion-icon color="primary" slot="start" name="battery-full" size="large"></ion-icon>
            <ion-label>วงเงินได้รับ</ion-label>
            <ion-label class="w3-display-right">{{ sumcpFm.credit_approve | number: '1.1-2' }}</ion-label>
          </ion-item>
          <ion-item lines="full">
            <ion-grid>
              <ion-row>
                <ion-col size="6" class="txtSmall ion-text-left">
                  <ion-text> วงเงิน {{ sumcpFm.credit_amount | number: '1.1-2' }}
                  </ion-text>
                </ion-col>
                <ion-col size="6" class="txtSmall ion-text-right">
                  <ion-text> ปัจจัย {{ sumcpFm.manure_amount | number: '1.1-2' }}</ion-text>
                </ion-col>
              </ion-row>
            </ion-grid>
          </ion-item>
          <ion-item [button]="true">
            <ion-icon color="warning" slot="start" name="battery-half" size="large"></ion-icon>
            <ion-label> วงเงินใช้ไป </ion-label>
            <ion-label class="w3-display-right">0</ion-label>
          </ion-item>
          <ion-item [button]="true">
            <ion-icon color="danger" slot="start" name="battery-dead" size="large"></ion-icon>
            <ion-label> วงเงินคงเหลือ </ion-label>
            <ion-label class="w3-display-right">0</ion-label>
          </ion-item>
          <ion-item [button]="true">
            <ion-icon color="primary" slot="start" name="bus"></ion-icon>
            <ion-label> หลักทรัพย์ประเมิน </ion-label>
            <ion-label class="w3-display-right">{{ crFm.sumRealty | number: '1.1-2' }}</ion-label>
            <!-- <ion-label slot="end">{{ crFm.guaranter | number: '1.1-2' }}</ion-label> -->
          </ion-item>
          <div class="card card-outline card-primary collapsed-card">
            <div class="card-header">
              <h3 class="card-title">
                <ion-icon color="primary" slot="start" name="people"></ion-icon>
                ผู้ค้ำประกัน/หลักทรัพย์
              </h3>
              <div class="card-tools">
                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                  <ion-icon name="arrow-down-outline"></ion-icon>
                  <!-- <i class="fas fa-minus"></i> -->
                </button>
              </div>
            </div>
            <div class="card-body" *ngIf="guarantor">
              <ion-list>
                <ion-item>
                  <ion-icon aria-hidden="true" name="person-add" slot="start"></ion-icon>
                  <ion-label>{{ guarantor.FmCode1}} : {{ guarantor.FullName1}}</ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon aria-hidden="true" name="person-add" slot="start"></ion-icon>
                  <ion-label>{{ guarantor.FmCode2}} : {{ guarantor.FullName2}}</ion-label>
                </ion-item>
                <ion-item>
                  <ion-icon aria-hidden="true" name="person-add" slot="start"></ion-icon>
                  <ion-label>{{ guarantor.FmCode3}} : {{ guarantor.FullName3}}</ion-label>
                </ion-item>
                <ion-item class="txtSmall">
                  <ion-icon aria-hidden="true" name="layers-outline" slot="start"></ion-icon>
                  <ion-label> {{ guarantor.type1 }} </ion-label>
                </ion-item>
                <ion-item class="txtSmall">
                  <ion-icon aria-hidden="true" name="layers-outline" slot="start"></ion-icon>
                  <ion-label> {{ guarantor.type2 }} </ion-label>
                </ion-item>
                <ion-item class="txtSmall">
                  <ion-icon aria-hidden="true" name="layers-outline" slot="start"></ion-icon>
                  <ion-label> {{ guarantor.type3}} </ion-label>
                </ion-item>
                <ion-item class="txtSmall">
                  <ion-icon aria-hidden="true" name="layers-outline" slot="start"></ion-icon>
                  <ion-label> {{ guarantor.type4}} </ion-label>
                </ion-item>
                <ion-item class="txtSmall">
                  <ion-icon aria-hidden="true" name="layers-outline" slot="start"></ion-icon>
                  <ion-label> {{ guarantor.type5}} </ion-label>
                </ion-item>
                <ion-item class="txtSmall">
                  <ion-icon aria-hidden="true" name="layers-outline" slot="start"></ion-icon>
                  <ion-label> {{ guarantor.type6}} </ion-label>
                </ion-item>
                <ion-item class="txtSmall">
                  <ion-icon aria-hidden="true" name="layers-outline" slot="start"></ion-icon>
                  <ion-label> {{ guarantor.type7}} </ion-label>
                </ion-item>
              </ion-list>
            </div>
          </div>
          <!-- <ion-item [button]="true">
            <ion-icon color="primary" slot="start" name="people"></ion-icon>
            <ion-label> ผู้ค้ำประกัน </ion-label>
            <ion-label class="w3-display-right">{{ guarantor }}</ion-label>
          </ion-item> -->
          <ion-text class="txtSmall w3-right">*กรุณาเช็คกับฝ่ายสินเชื่ออีกครั้ง</ion-text>
        </ion-list>
      </div>
    </ion-card-content>
  </ion-card>

  <!-- ข้อมูลหนี้ -->
  <ion-card class="boxGreenPowerpointR w3-light-blue divPadding-10" style="margin-bottom: 25px;">
    <ion-card-content>
      <div style="margin-top: 3%;">
        <ion-card-title style="margin-bottom: 3%;" color="dark">หนี้ ณ {{ loanFm.DateupdateTH }}</ion-card-title>
        <!-- ยอดหนี้ปีปัจจุบัน -->
        <div class="card card-primary">
          <div class="card-header">
            <h3 class="card-title">หนี้ {{ setnY(yearThX) }}</h3>
            <div class="card-tools">
              <span title="" class="badge bg-primary txtBolder txtLarger">{{ loanThisyear | number: '1.1-2' }}</span>
              <!-- <ion-button fill="outline" class="w3-right txtBolder">
                {{ loanThisyear | number: '1.1-2' }}
              </ion-button> -->
              <button type="button" class="btn btn-tool" data-card-widget="collapse">
                <ion-icon name="arrow-down-outline"></ion-icon>
              </button>
              <!-- <button type="button" class="btn btn-tool" title="Contacts" data-widget="chat-pane-toggle">
                <ion-icon name="chatbox-ellipses-outline"></ion-icon>
              </button> -->
              <!-- <button type="button" class="btn btn-tool" data-card-widget="remove">
                <i class="fas fa-times"></i>
              </button> -->
            </div>
          </div>
          <div class="card-body">

            <div class="card-body table-responsive p-0" style="height: 300px;">
              <table class="table table-head-fixed text-nowrap w3-card-4 w3-tiny">
                <thead>
                  <tr>
                    <th>วันที่</th>
                    <th>รายการ</th>
                    <th class="">จำนวนเงิน</th>
                  </tr>
                </thead>
                <tbody *ngIf="listloanFm">
                  <tr *ngFor="let item of listloanFm ">
                    <td>{{ item.StartDeductSugDate | date: 'dd/MM/yyyy' }}</td>
                    <td>{{ item.loandesc }}</td>
                    <td class="">{{ item.balance | number: '1.2-2' }}</td>
                  </tr>
                </tbody>
                <tr class="txtLarge">
                  <td colspan="2">++รวม++</td>
                  <td class="w3-text-right w3-light-gray">
                    {{ calculateTotal(listloanFm) | number : '1.2-2' }}
                  </td>
                </tr>
              </table>
            </div>

            <!-- Contacts are loaded here -->
            <div class="direct-chat-contacts">
              <ul class="contacts-list">
                <li>
                  <a href="#">
                    <img class="contacts-list-img" src="../dist/img/user1-128x128.jpg" alt="User Avatar">

                    <div class="contacts-list-info">
                      <span class="contacts-list-name">
                        Count Dracula
                        <small class="contacts-list-date float-right">2/28/2015</small>
                      </span>
                      <span class="contacts-list-msg">How have you been? I was...</span>
                    </div>
                    <!-- /.contacts-list-info -->
                  </a>
                </li>
                <!-- End Contact Item -->
              </ul>
              <!-- /.contatcts-list -->
            </div>
          </div>
          <div class="card-footer">
            <!-- <form action="#" method="post">
              <div class="input-group">
                <input type="text" name="message" placeholder="Type Message ..." class="form-control">
                <span class="input-group-append">
                  <button type="submit" class="btn btn-primary">Send</button>
                </span>
              </div>
            </form> -->
          </div>
        </div>

        <!-- หนี้แต่ละปี -->
        <div class="card card-primary collapsed-card">
          <div class="card-header">
            <h3 class="card-title">รายละเอียดหนี้แต่ละปี</h3>

            <div class="card-tools">
              <button type="button" class="btn btn-tool" data-card-widget="collapse">
                <ion-icon name="arrow-down-outline"></ion-icon>
                <!-- <i class="fas fa-plus"></i> -->
              </button>
            </div>
          </div>
          <div class="card-body">
            <div *ngFor="let keyY of LoanDatailKeys" class="card card-primary collapsed-card card-outline">
              <div class="card-header">
                <ion-label class="w3-left"> หนี้ {{ setnY(keyY) }} =
                  {{ calculateTotal(LoanDatailData[keyY]) | number : '1.2-2' }}</ion-label>
                <ion-button fill="clear" class="w3-right" data-card-widget="collapse">
                  <ion-icon slot="end" name="arrow-down-circle-outline"></ion-icon>
                </ion-button>
              </div>
              <div class="card-body">
                <div class="card-body table-responsive p-0" style="height: 300px;">
                  <table class="table table-head-fixed text-nowrap w3-card-4 w3-tiny">
                    <thead>
                      <tr>
                        <th>วันที่</th>
                        <th>รายการ</th>
                        <th class="w3-right">จำนวนเงิน</th>
                      </tr>
                    </thead>
                    <tbody *ngIf="LoanDatailData">
                      <tr *ngFor="let item of LoanDatailData[keyY]">
                        <td>{{ item.StartDeductSugDate | date: 'dd/MM/yyyy' }}</td>
                        <td>{{ item.loandesc }}</td>
                        <td class="w3-right">{{ item.balance | number: '1.2-2' }}</td>
                      </tr>
                    </tbody>
                    <tfoot>
                      <tr class="txtLarge">
                        <td colspan="2">++รวม++</td>
                        <td class="w3-text-right txtBolder w3-light-gray">
                          {{ calculateTotal(LoanDatailData[keyY]) | number : '1.2-2' }}
                        </td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <ion-text class="txtSmall w3-right">*กรุณาเช็คกับฝ่ายสินเชื่ออีกครั้ง</ion-text>
        <!-- </ion-list> -->
      </div>
    </ion-card-content>
  </ion-card>

  <ion-item color="medium">
    <ion-select (ionChange)="selectyear($event)" label="เลือกปีของข้อมูล" placeholder="">
      <ion-select-option value="" disabled>++เลือกปี++</ion-select-option>
      <ion-select-option *ngFor="let i of yearData" value="{{i.yearTh}}">{{ i.yearDesc }}
      </ion-select-option>
    </ion-select>
  </ion-item>

  <!-- รายการขอสินเชื่อ -->
  <ion-list lines="full">
    <ion-title>
      <ion-icon name="list-outline"></ion-icon>
      รายการขอสินเชื่อ ปี {{ setnY(yearThX) }}
    </ion-title>

    <div class="card-body table-responsive p-0" style="height: 300px;">
      <table class="table table-head-fixed text-nowrap w3-card-4 w3-tiny">
        <thead>
          <tr class="text-indigo">
            <th>วันที่</th>
            <th>แปลง</th>
            <th>รายการ</th>
            <th>จำนวนเงิน</th>
            <th>สถานะ</th>
          </tr>
        </thead>
        <tbody *ngIf="fnData">
          <tr *ngFor="let item of fnData">
            <td>{{ item.datepost_th }}</td>
            <td>{{ item.intlandno }} {{ item.canename }} พท. {{ item.landvalue }}</td>
            <td>{{ item.comment1 }}</td>
            <td>{{ item.money_amt | number: '1.2-2' }}</td>
            <td [ngClass]="{'w3-text-teal': item.doc_status == '4', 'w3-text-red': item.doc_status !== '4'}">
              {{ item.docdesc }}</td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="5">++รวม++</td>
            <!-- <td class="w3-text-right txtBolder w3-light-gray">
              {{ calculateTotal(LoanDatailData[keyY]) | number : '1.2-2' }}
            </td> -->
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- <ion-list>
      <ion-card *ngFor="let item of fnData | async; let i = index">
        <ion-card-header (click)="toggleSection(i)" class="header">
          แปลง {{ item.intlandno }}
        </ion-card-header>
        <ion-card-content [ngClass]="{'detail-enabled': clicked[i], 'detail-off': !clicked[i]}">
          {{ item.canename }} พท. {{ item.landvalue }}
        </ion-card-content>
      </ion-card>
    </ion-list> -->

    <!-- <div *ngFor="let i of fnData" class="w3-card-4">

      <header class="w3-container w3-light-blue divPadding-5">
        <ion-icon *ngIf="i.doc_status =='4'" name="bag-check" color="success" slot="start"></ion-icon>
        <ion-icon *ngIf="i.doc_status =='D'" name="ban" color="danger" slot="start"></ion-icon>
        <ion-icon *ngIf="i.doc_status !=='4'" name="time-outline" color="warning" slot="start">
        </ion-icon>
        <h6>แปลง {{ i.intlandno }}</h6>
        <p>{{ i.canename }} พท. {{ i.landvalue }}</p>
      </header>

      <div class="w3-container">
        <img src="../../../assets/icon/add-user.png" alt="Avatar" class="w3-left w3-circle">
        <p>เรื่อง {{ i.comment1 }}</p>
        <p>จำนวนเงิน {{ i.money_amt | number:'1.2-2' }} บาท</p>
        <p>ขอเมื่อวันที่ {{ i.datepost_th }} </p>
        <p>ผู้ทำเรื่องขอ {{ i.sup_U }} </p>
        <p>พนักงานสินเชื่อ {{ i.fn_U }} </p>
        <p>รับเรื่องเมื่อ {{ i.fnAccept_th }} </p>
        <p>ความเห็นสินเชื่อ {{ i.comment6 }}</p>
        <p>วันที่สินเชื่ออนุมั้ติ {{ i.dateapprove_th }}</p>
      </div>
      <button class="w3-button w3-block w3-dark-grey">สถานะเกี้ยว {{ i.docdesc }}</button>

    </div> -->

    <!-- <ion-accordion-group *ngFor="let i of fnData">
      <ion-accordion value="i.intlandno">
        <ion-item slot="header" class="w3-khaki">
          <ion-icon *ngIf="i.doc_status =='4'" name="bag-check" color="success" slot="start"></ion-icon>
          <ion-icon *ngIf="i.doc_status =='D'" name="ban" color="danger" slot="start"></ion-icon>
          <ion-icon *ngIf="i.doc_status !=='4'" name="time-outline" color="warning" slot="start">
          </ion-icon>
          <ion-label>{{ i.datepost_th }} > {{ i.comment1 }} </ion-label>
          <ion-label slot="end">{{ i.money_amt | number:'1.2-2' }}</ion-label>
        </ion-item>
        <div class="ion-padding" slot="content">
          <div class="w3-card-4">

            <header class="w3-container w3-amber divPadding-5">
              <h6>แปลง {{ i.intlandno }}</h6>
              <p>{{ i.canename }} พท. {{ i.landvalue }}</p>
            </header>

            <div class="w3-container">
              <img src="../../../assets/icon/add-user.png" alt="Avatar" class="w3-left w3-circle">
              <p>เรื่อง {{ i.comment1 }}</p>
              <p>จำนวนเงิน {{ i.money_amt | number:'1.2-2' }} บาท</p>
              <p>ขอเมื่อวันที่ {{ i.datepost_th }} </p>
              <p>ผู้ทำเรื่องขอ {{ i.sup_U }} </p>
              <p>พนักงานสินเชื่อ {{ i.fn_U }} </p>
              <p>รับเรื่องเมื่อ {{ i.fnAccept_th }} </p>
              <p>ความเห็นสินเชื่อ {{ i.comment6 }}</p>
              <p>วันที่สินเชื่ออนุมั้ติ {{ i.dateapprove_th }}</p>
            </div>

            <button class="w3-button w3-block w3-dark-grey">สถานะเกี้ยว {{ i.docdesc }}</button>

          </div>

        </div>
      </ion-accordion>
    </ion-accordion-group> -->

  </ion-list>

  <!-- รายการเบิกปัจจัยการผลิต -->
  <ion-list lines="full">
    <ion-title>
      <ion-icon name="list-outline"></ion-icon>
      รายการเบิกปัจจัยฯ ปี {{ setnY(yearThX) }}
    </ion-title>

    <div class="card-body table-responsive p-0" style="height: 300px;">
      <table class="table table-head-fixed text-nowrap w3-table-all w3-card-4 w3-tiny">
        <thead>
          <tr class="text-indigo">
            <th>วันที่</th>
            <th>แปลง</th>
            <th>ปุ๋ยเคมี</th>
            <th>จำนวน</th>
            <th>อินทรีย์</th>
            <th>จำนวน</th>
            <th>ยาฯ</th>
            <th>จำนวน</th>
            <th>สต็อค</th>
          </tr>
        </thead>
        <tbody *ngIf="factorData">
          <tr *ngFor="let item of factorData">
            <td>{{ item.datepost_th }}</td>
            <td>{{ item.intlandno }} {{ item.CaneTypeName }} พท. {{ item.landvalue }}</td>
            <td>{{ item.desc1 }}</td>
            <td>{{ item.amt1 | number: '1.2-2' }}</td>
            <td>{{ item.desc2 }}</td>
            <td>{{ item.amt2 | number: '1.2-2' }}</td>
            <td>{{ item.desc3 }}</td>
            <td>{{ item.amt3 | number: '1.2-2' }}</td>
            <td>{{ item.Stockname }}</td>
          </tr>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="9">++++</td>
            <!-- <td class="w3-text-right txtBolder w3-light-gray">
              {{ calculateTotal(LoanDatailData[keyY]) | number : '1.2-2' }}
            </td> -->
          </tr>
        </tfoot>
      </table>
    </div>

  </ion-list>

</ion-content>
